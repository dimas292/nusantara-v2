---
const navItems = [
    { id: "home", labelId: "Beranda", labelEn: "Home" },
    { id: "intro", labelId: "Pengenalan", labelEn: "Intro" },
    { id: "history", labelId: "Sejarah", labelEn: "History" },
    { id: "map", labelId: "Peta", labelEn: "Map" },
    { id: "gallery", labelId: "Galeri", labelEn: "Gallery" },
    { id: "education", labelId: "Edukasi", labelEn: "Education" },
];
---

<nav class="navbar" id="navbar">
    <div class="navbar__container container flex flex--between">
        <!-- Logo -->
        <a href="#home" class="navbar__logo">
            <span class="navbar__logo-text">Nusantara</span>
        </a>

        <!-- Desktop Menu -->
        <ul class="navbar__menu" id="nav-menu">
            {
                navItems.map((item) => (
                    <li class="navbar__item">
                        <a
                            href={`#${item.id}`}
                            class="navbar__link"
                            data-section={item.id}
                            data-label-id={item.labelId}
                            data-label-en={item.labelEn}
                        >
                            <span class="nav-label">{item.labelId}</span>
                        </a>
                    </li>
                ))
            }
        </ul>

        <!-- Language Toggle -->
        <div class="navbar__actions flex">
            <button
                class="lang-toggle"
                id="lang-toggle"
                aria-label="Toggle Language"
            >
                <span
                    class="lang-toggle__option lang-toggle__option--active"
                    data-lang="id">ID</span
                >
                <span class="lang-toggle__divider">|</span>
                <span class="lang-toggle__option" data-lang="en">EN</span>
            </button>

            <!-- Mobile Menu Button -->
            <button
                class="navbar__hamburger"
                id="hamburger"
                aria-label="Toggle Menu"
            >
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div class="navbar__mobile-menu" id="mobile-menu">
        <ul class="navbar__mobile-list">
            {
                navItems.map((item) => (
                    <li class="navbar__mobile-item">
                        <a
                            href={`#${item.id}`}
                            class="navbar__mobile-link"
                            data-section={item.id}
                            data-label-id={item.labelId}
                            data-label-en={item.labelEn}
                        >
                            <span class="nav-label">{item.labelId}</span>
                        </a>
                    </li>
                ))
            }
        </ul>
    </div>
</nav>

<style>
    .navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: var(--nav-height);
        background-color: white;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        /* border-bottom: 8px solid black; */
        box-shadow: inset 0 -1px 0 rgba(27, 27, 27, 0.05);
        z-index: 1000;
        transition: all var(--transition-base);
    }

    .navbar__container {
        height: 100%;
    }

    .navbar__logo {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }

    .navbar__logo-text {
        font-family: var(--font-serif);
        font-size: var(--text-xl);
        font-weight: 700;
        color: var(--charcoal);
        letter-spacing: -0.02em;
    }

    .navbar__menu {
        display: flex;
        align-items: center;
        gap: var(--space-xl);
        list-style: none;
    }

    .navbar__link {
        position: relative;
        font-size: var(--text-md);
        font-weight: bold;
        color: var(--charcoal);
        padding: var(--space-sm) 0;
        transition: color var(--transition-fast);
    }

    .navbar__link::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 3px;
        background-color: var(--terracotta);
        transition: width var(--transition-base);
    }

    .navbar__link:hover::after,
    .navbar__link.active::after {
        width: 100%;
    }

    .navbar__link.active {
        color: var(--terracotta);
    }

    /* Language Toggle */
    .lang-toggle {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        background: transparent;
        border: 1px solid rgba(27, 27, 27, 0.1);
        border-radius: var(--radius-md);
        padding: var(--space-xs) var(--space-sm);
        font-family: var(--font-sans);
        font-size: var(--text-xs);
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .lang-toggle:hover {
        border-color: var(--terracotta);
    }

    .lang-toggle__option {
        color: var(--muted-ink);
        transition: color var(--transition-fast);
    }

    .lang-toggle__option--active {
        color: var(--terracotta);
    }

    .lang-toggle__divider {
        color: rgba(27, 27, 27, 0.2);
    }

    .navbar__hamburger {
        display: none;
        flex-direction: column;
        justify-content: center;
        gap: 5px;
        width: 32px;
        height: 32px;
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 4px;
    }

    .hamburger-line {
        width: 100%;
        height: 2px;
        background-color: var(--charcoal);
        border-radius: 2px;
        transition: all var(--transition-base);
        transform-origin: center;
    }

    .navbar__hamburger.active .hamburger-line:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
    }

    .navbar__hamburger.active .hamburger-line:nth-child(2) {
        opacity: 0;
    }

    .navbar__hamburger.active .hamburger-line:nth-child(3) {
        transform: rotate(-45deg) translate(5px, -5px);
    }

    /* Mobile Menu */
    .navbar__mobile-menu {
        position: fixed;
        top: var(--nav-height);
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--warm-white);
        padding: var(--space-2xl);
        transform: translateX(100%);
        transition: transform var(--transition-base);
        z-index: 999;
    }

    .navbar__mobile-menu.active {
        transform: translateX(0);
    }

    .navbar__mobile-list {
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: var(--space-lg);
    }

    .navbar__mobile-link {
        font-family: var(--font-serif);
        font-size: var(--text-2xl);
        font-weight: 600;
        color: var(--charcoal);
        display: block;
        padding: var(--space-sm) 0;
        border-bottom: 1px solid rgba(27, 27, 27, 0.05);
        transition: color var(--transition-fast);
    }

    .navbar__mobile-link:hover,
    .navbar__mobile-link.active {
        color: var(--terracotta);
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .navbar__menu {
            display: none;
        }

        .navbar__hamburger {
            display: flex;
        }
    }
</style>

<script>
    import gsap from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    gsap.registerPlugin(ScrollTrigger);

    // Navbar scroll effect
    const navbar = document.getElementById("navbar");

    window.addEventListener("scroll", () => {
        if (window.scrollY > 50) {
            navbar?.classList.add("scrolled");
        } else {
            navbar?.classList.remove("scrolled");
        }
    });

    // Mobile menu toggle
    const hamburger = document.getElementById("hamburger");
    const mobileMenu = document.getElementById("mobile-menu");

    hamburger?.addEventListener("click", () => {
        hamburger.classList.toggle("active");
        mobileMenu?.classList.toggle("active");
        document.body.style.overflow = mobileMenu?.classList.contains("active")
            ? "hidden"
            : "";
    });

    // Close mobile menu on link click
    document.querySelectorAll(".navbar__mobile-link").forEach((link) => {
        link.addEventListener("click", () => {
            hamburger?.classList.remove("active");
            mobileMenu?.classList.remove("active");
            document.body.style.overflow = "";
        });
    });

    // Active link on scroll
    const sections = document.querySelectorAll("section[id]");
    const navLinks = document.querySelectorAll(
        ".navbar__link, .navbar__mobile-link",
    );

    function setActiveLink() {
        const scrollY = window.scrollY;

        sections.forEach((section) => {
            const sectionTop = (section as HTMLElement).offsetTop - 100;
            const sectionHeight = section.clientHeight;
            const sectionId = section.getAttribute("id");

            if (scrollY >= sectionTop && scrollY < sectionTop + sectionHeight) {
                navLinks.forEach((link) => {
                    link.classList.remove("active");
                    if (link.getAttribute("data-section") === sectionId) {
                        link.classList.add("active");
                    }
                });
            }
        });
    }

    window.addEventListener("scroll", setActiveLink);

    // Language toggle
    const langToggle = document.getElementById("lang-toggle");
    const langOptions = langToggle?.querySelectorAll(".lang-toggle__option");
    let currentLang = localStorage.getItem("lang") || "en";

    function updateLanguage(lang: string) {
        currentLang = lang;
        localStorage.setItem("lang", lang);

        langOptions?.forEach((opt) => {
            opt.classList.toggle(
                "lang-toggle__option--active",
                opt.getAttribute("data-lang") === lang,
            );
        });

        // Update all nav labels
        document.querySelectorAll("[data-label-id]").forEach((el) => {
            const labelId = el.getAttribute("data-label-id");
            const labelEn = el.getAttribute("data-label-en");
            const labelSpan = el.querySelector(".nav-label");
            if (labelSpan) {
                labelSpan.textContent = lang === "id" ? labelId : labelEn;
            }
        });

        // Dispatch custom event for other components
        window.dispatchEvent(
            new CustomEvent("langchange", { detail: { lang } }),
        );
    }

    langToggle?.addEventListener("click", () => {
        const newLang = currentLang === "id" ? "en" : "id";
        updateLanguage(newLang);
    });

    // Initialize language
    updateLanguage(currentLang);
</script>
