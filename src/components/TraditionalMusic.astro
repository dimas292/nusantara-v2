---
const content = {
    id: {
        eyebrow: "Tunes",
        title: "Musik Tradisional Indonesia",
        description:
            "Dengarkan keindahan musik tradisional dari berbagai daerah di Indonesia.",
    },
    en: {
        eyebrow: "Tunes",
        title: "Traditional Indonesian Music",
        description:
            "Listen to the beauty of traditional music from various regions in Indonesia.",
    },
};

const musicList = [
    {
        spotifyDataIframe: "https://open.spotify.com/embed/track/10JUVILEVeEkfktkizDnlB?utm_source=generator&theme=0",
    },
    {
        spotifyDataIframe: "https://open.spotify.com/embed/track/1OeNwoBYiKtYB3pH7Z6JOt?utm_source=generator&theme=0",
    },
    {
        spotifyDataIframe: "https://open.spotify.com/embed/track/0qT9JoK7tMG3wJrko2QtI3?utm_source=generator&theme=0",
    },
    {
        
        spotifyDataIframe: "https://open.spotify.com/embed/track/2UcsTmjCr6bj1oaMaMXG8V?utm_source=generator&theme=0",
    },
    {
        
        spotifyDataIframe: "https://open.spotify.com/embed/track/6ia7g9aGpMiinRMy1z3ZgT?utm_source=generator&theme=0",
    },
    {
        
        spotifyDataIframe: "https://open.spotify.com/embed/track/2tkFECDMLbZvJG4G7vQeQy?utm_source=generator&theme=0",
    },
    {
        
        spotifyDataIframe: "https://open.spotify.com/embed/track/11aCnJscmhzCLVYEAyim5V?utm_source=generator&theme=0",
    },
];
---

<section class="music section bg-batik" id="music">
    <div class="container">
        <!-- Section Header -->
        <div class="music__header section-header fade-up">
            <span
                class="section-header__eyebrow"
                data-content-id="Melodi Nusantara"
                data-content-en="Nusantara Melodies"
            >
                {content.id.eyebrow}
            </span>
            <h2
                class="section-header__title"
                data-content-id={content.id.title}
                data-content-en={content.en.title}
            >
                {content.id.title}
            </h2>
            <p
                class="music__description"
                data-content-id={content.id.description}
                data-content-en={content.en.description}
            >
                {content.id.description}
            </p>
        </div>

        <!-- Music Card -->
        <div class="music-card">
            {
                musicList.map((music, index) => (
                    <div class={`music-item fade-up ${index >= 5 ? 'music-item--hidden' : ''}`} style={`--item-index: ${index}`}>
                        <span class="music-item__number">{String(index + 1).padStart(2, '0')}</span>

                        <!-- Spotify Embed -->
                        <div class="music-item__player">
                          <iframe data-testid="embed-iframe" style="border-radius:12px" src={music.spotifyDataIframe} width="100%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                        </div>
                    </div>
                ))
            }
        </div>

        <!-- Music Footer -->
        <div class="music__footer fade-up">
            <button 
                id="music-toggle-btn"
                class="music__more-link"
                data-state="collapsed"
            >
                <span class="music__more-text" data-text-id="Lebih banyak" data-text-en="Show More">Lebih banyak</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                    <polyline points="12 5 19 12 12 19"></polyline>
                </svg>
            </button>
        </div>
    </div>
</section>

<style>
    .music {
        padding: var(--space-4xl) 0;
        overflow: hidden;
    }

    .music__footer {
        margin-top: var(--space-xl);
        text-align: right;
        display: flex;
        justify-content: flex-end;
    }

    .music__more-link {
        display: inline-flex;
        align-items: center;
        gap: var(--space-xs);
        font-family: var(--font-sans);
        font-size: var(--text-base);
        font-weight: 500;
        color: var(--terracotta);
        text-decoration: none;
        transition: color 0.3s ease;
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
    }

    .music__more-link:hover {
        color: var(--charcoal);
    }

    .music__more-link svg {
        transition: transform 0.3s ease;
    }

    .music__more-link[data-state="expanded"] svg {
        transform: rotate(180deg);
    }

    .music__header {
        text-align: center;
        margin-bottom: var(--space-4xl);
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
    }

    .music__description {
        font-size: var(--text-lg);
        color: var(--muted-ink);
        line-height: 1.8;
        margin-top: var(--space-lg);
    }

    /* Music Card - Container */
    .music-card {
        background: transparent;
        max-width: 1200px;
        margin: 0 auto;
    }

    /* Music Item - Each row inside card */
    .music-item {
        display: flex;
        align-items: center;
        gap: var(--space-md);
        padding: var(--space-xs) 0;
        border-bottom: none;
        /* Initial state for animation */
        opacity: 0;
        transform: translateY(30px);
        will-change: opacity, transform;
        transition: opacity 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94), 
                    transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .music-item.music-item--hidden {
        display: none;
    }

    .music-card.is-visible .music-item:not(.music-item--hidden) {
        opacity: 1;
        transform: translateY(0);
    }

    .music-card.is-visible .music-item.is-revealed {
        opacity: 1;
        transform: translateY(0);
    }

    .music-item:last-child {
        padding-bottom: 0;
    }

    .music-item:first-child {
        padding-top: 0;
    }

    .music-item__number {
        font-family: var(--font-serif);
        font-size: var(--text-2xl);
        font-weight: 700;
        color: #000000;
        line-height: 1;
        min-width: 40px;
        flex-shrink: 0;
    }

    /* Spotify Player */
    .music-item__player {
        border-radius: var(--radius-lg);
        overflow: hidden;
        background: #f5f5f5;
        flex: 1;
    }

    .spotify-embed {
        border: none;
        border-radius: var(--radius-lg);
    }

    /* Responsive */
    @media (max-width: 768px) {
        .music-card {
            padding: var(--space-xl);
        }

        .music-item {
            gap: var(--space-md);
        }

        .music-item__number {
            font-size: var(--text-xl);
            min-width: 30px;
        }
    }

    @media (max-width: 480px) {
        .music {
            padding: var(--space-2xl) 0;
        }

        .music__header {
            margin-bottom: var(--space-2xl);
        }

        .music-card {
            padding: var(--space-lg);
        }

        .music-item {
            flex-direction: row;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md) 0;
        }

        .music-item__number {
            font-size: var(--text-lg);
            min-width: 25px;
        }
    }
</style>

<script>
    // IntersectionObserver for fade-in animation
    const observerOptions = {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px"
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
                entry.target.classList.add("is-visible");
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    const musicCard = document.querySelector(".music-card");
    if (musicCard) {
        observer.observe(musicCard);
    }

    // Toggle Functionality
    const toggleBtn = document.getElementById("music-toggle-btn");
    const hiddenItems = document.querySelectorAll(".music-item--hidden");
    const textSpan = toggleBtn?.querySelector(".music__more-text");

    toggleBtn?.addEventListener("click", () => {
        const isCollapsed = toggleBtn.getAttribute("data-state") === "collapsed";
        const newState = isCollapsed ? "expanded" : "collapsed";
        
        toggleBtn.setAttribute("data-state", newState);
        
        // Toggle visibility
        hiddenItems.forEach(item => {
            if (isCollapsed) {
                item.classList.remove("music-item--hidden");
                // Small delay to allow display block to apply before transition
                setTimeout(() => item.classList.add("is-revealed"), 50);
            } else {
                item.classList.remove("is-revealed");
                item.classList.add("music-item--hidden");
            }
        });

        // Update Text
        const currentLang = localStorage.getItem("lang") || "en";
        updateButtonText(currentLang, newState);
    });

    function updateButtonText(lang: string, state: string) {
        if (!textSpan) return;
        
        if (state === "collapsed") {
            textSpan.textContent = lang === 'id' ? "Lebih banyak" : "Show More";
        } else {
            textSpan.textContent = lang === 'id' ? "Tampilkan lebih sedikit" : "Show Less";
        }
    }

    // Language change handler
    window.addEventListener("langchange", (e: CustomEvent) => {
        const lang = e.detail.lang;

        // Update standard content
        document.querySelectorAll("[data-content-id]").forEach((el) => {
            const contentId = el.getAttribute("data-content-id");
            const contentEn = el.getAttribute("data-content-en");
            // Only update if it doesn't have children (pure text nodes) or specific logic handling children
            if (!el.children.length && contentId && contentEn) {
                el.textContent = lang === "id" ? contentId : contentEn;
            }
        });

        // Update button text state awareness
        const currentState = toggleBtn?.getAttribute("data-state") || "collapsed";
        updateButtonText(lang, currentState);
    });
</script>
