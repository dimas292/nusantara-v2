---
const content = {
    id: {
        eyebrow: "Perjalanan Waktu",
        title: "Sejarah Nusantara",
        subtitle: "Menelusuri jejak peradaban yang membentuk Indonesia",
    },
    en: {
        eyebrow: "Journey Through Time",
        title: "History of Nusantara",
        subtitle:
            "Tracing the footsteps of civilizations that shaped Indonesia",
    },
};

const iframeSrt = {
    id: {
        src: "https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=v2%3A2PACX-1vRWx87SdRdSS3bfV9UW-JglcrIVDak3muoeo7BcL9yAROx2XHlMC3U5O4HadjekGr0mzvziazSwuR8e&font=Default&lang=en&initial_zoom=2&width=100%25&height=650"
    },
    en: {
        src: "https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=v2%3A2PACX-1vSnFO5p_FDUzpCb70RM9DtVqhghdo-uHlbAEIYAWhlKLpxteAmNG4Jocy91CfO9B81QT9lhC9ZplXp8&font=Default&lang=en&initial_zoom=2&width=100%25&height=650"
    },
}
---

<section
    class="timeline section section--alt"
    id="history"
    style="background-color: var(--charcoal); color: var(--warm-white);"
>
    <div class="container">
        <!-- Section Header -->
        <div class="section-header fade-up">
            <span
                class="section-header__eyebrow"
                data-content-id={content.id.eyebrow}
                data-content-en={content.en.eyebrow}
            >
                {content.id.eyebrow}
            </span>
            <h2
                class="section-header__title"
                data-content-id={content.id.title}
                data-content-en={content.en.title}
                style="color: var(--warm-white);"
            >
                {content.id.title}
            </h2>
            <p
                class="section-header__subtitle"
                data-content-id={content.id.subtitle}
                data-content-en={content.en.subtitle}
                style="color: rgba(255,255,255,0.8);"
            >
                {content.id.subtitle}
            </p>
        </div>

        <!-- TimelineJS Embed -->
        <div class="timeline__embed fade-up">
            <iframe
                id="timeline-iframe"
                src={iframeSrt.id.src}
                width="100%"
                height="650"
                allowfullscreen
                frameborder="0"
            >
            </iframe>
        </div>
    </div>
</section>

<script define:vars={{ iframeSrt }}>
    window.timelineIframeSrc = iframeSrt;
</script>

<style>
    .timeline__embed {
        width: 100%;
        height: 650px;
        border-radius: var(--radius-lg);
        overflow: hidden;
        box-shadow: var(--shadow-xl);
        background-color: var(--warm-white);
    }
</style>

<script>
    import gsap from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    gsap.registerPlugin(ScrollTrigger);

    const timelineIframeSrc = (window as any).timelineIframeSrc;
    const timelineIframe = document.getElementById("timeline-iframe") as HTMLIFrameElement;

    // Language change handler
    window.addEventListener("langchange", (e: CustomEvent) => {
        const lang = e.detail.lang;

        document
            .querySelectorAll(".timeline [data-content-id]")
            .forEach((el) => {
                const contentId = el.getAttribute("data-content-id");
                const contentEn = el.getAttribute("data-content-en");
                el.textContent = lang === "id" ? contentId : contentEn;
            });

        // Update iframe src based on language
        if (timelineIframe && timelineIframeSrc) {
            timelineIframe.src = lang === "id" ? timelineIframeSrc.id.src : timelineIframeSrc.en.src;
        }
    });
</script>
